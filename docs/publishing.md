# Publishing to VS Code Marketplace

## Prerequisites

1. Create a publisher on [Visual Studio Marketplace](https://marketplace.visualstudio.com/manage) (publisher ID: `nuget-workbench`)
2. Generate a Personal Access Token (PAT) in [Azure DevOps](https://dev.azure.com/) with **Marketplace > Manage** scope
3. Add the PAT as a repository secret named `VSCE_PAT` (Settings > Secrets > Actions)

## Release via script (recommended)

The release script bumps the version, updates `CHANGELOG.md`, commits, tags, and pushes. The CI pipeline then publishes automatically.

```bash
npm run release                # patch bump (1.1.0 -> 1.1.1)
npm run release -- minor       # minor bump (1.1.0 -> 1.2.0)
npm run release -- major       # major bump (1.1.0 -> 2.0.0)
npm run release -- 3.0.0       # explicit version
npm run release -- --dry-run   # preview without changes
```

The script:
1. Validates clean working tree and `main` branch
2. Bumps version in `package.json` and `package-lock.json`
3. Moves `## Unreleased` entries in `CHANGELOG.md` into a versioned section
4. Writes `RELEASE_NOTES.md` (used as GitHub Release body)
5. Commits, tags (`vX.Y.Z`), and pushes

## Release via GitHub UI

Go to **Actions > CI > Run workflow**, select the version bump type, and click **Run workflow**. The pipeline builds, tests, runs the release script, publishes to the Marketplace, and creates a GitHub Release â€” all in one run.

## CI/CD pipeline

The GitHub Actions workflow (`.github/workflows/ci.yml`) has three jobs:

| Job | Trigger | Purpose |
|-----|---------|---------|
| `build` | push to `main`, PRs | Build, lint, test |
| `release` | `workflow_dispatch` | Build, test, release script, publish, GitHub Release |
| `publish` | tag `v*` (local push) | Publish to Marketplace, create GitHub Release with `.vsix` |

The `release` job handles the full flow when triggered via GitHub UI. The `publish` job handles releases pushed locally via `npm run release`. Release notes come from `RELEASE_NOTES.md` (generated by the release script).

## Manual publish

```bash
npm run package                           # builds releases/nuget-workbench-x.x.x.vsix
npx @vscode/vsce login nuget-workbench   # authenticate with PAT
npx @vscode/vsce publish --no-dependencies
```
